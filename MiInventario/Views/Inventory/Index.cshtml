@{
  ViewBag.Title = "Inventario";
}
<h2>Inventory</h2>
<section id="alertas"></section>
<div class="col-lg-5 col-md-6 col-sm-7 col-xs-12">
  <table class="table table-condensed table-striped" id="groupTotals">
    <colgroup>
      <col class="col-lg-6 col-md-6 col-sm-6 col-xs-6" />
      <col class="col-lg-2 col-md-2 col-sm-2 col-xs-2" />
      <col class="col-lg-2 col-md-2 col-sm-2 col-xs-2" />
      <col class="col-lg-2 col-md-2 col-sm-2 col-xs-2" />
    </colgroup>
    <thead>
      <tr>
        <th>Item</th>
        <th>Total</th>
        <th>Caps</th>
        <th></th>
      </tr>
    </thead>
    <tfoot></tfoot>
    <tbody></tbody>
  </table>
</div>
<div class="clearfix"></div>
@section scripts{
  <script type="text/javascript">
    $(document).ready(function () {
      $.ajax({
        url: '/Inventory/GroupsTotals',
        method: 'GET',
        dataType: "json",
        cache: false,
        success: function (data) {
          var capsulesGrandTotal = 0;
          var grandTotal = 0;

          $.each(data, function (key, group) {

            var html = '<tr>';
            html += '<td><a href="/Inventory/Manage/' + group.GroupID + '?editing=false">' + group.GroupName + '</a></td>';
            html += '<td class="cantidadItem">' + group.Total + '</td>';
            html += '<td class="cantidadCapsula">' + group.CapsulesTotal + '</td>';
            html += '<td class="text-center"><a href="/Inventory/Manage/' + group.GroupID + '?editing=true">Edit</a></td>';
            html += '</tr>';
            if (group.GroupID == 'G_ALL') {
              capsulesGrandTotal = group.CapsulesTotal;
              grandTotal = group.Total;

              $('#groupTotals tfoot').append(html);
            }
            else {
              $('#groupTotals tbody').append(html);
            }
          });

          if ((capsulesGrandTotal + grandTotal) > 2000) {
            $('#alertas').append('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">×</button>Total Items is greater than the maximum allowed (2000).</div>');
          }
        }
      });
    });
  </script>
}